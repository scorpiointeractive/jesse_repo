#!/bin/bash
#
# Cookbook Name:: puppet
#
# Copyright RightScale, Inc. All rights reserved.
# All access and use subject to the RightScale Terms of Service available at
# http://www.rightscale.com/terms.php and, if applicable, other agreements
# such as a RightScale Master Subscription Agreement.
#
# Managed by RightScale
# DO NOT EDIT BY HAND
#

UUID="<%= @uuid %>"
HOST="${COLLECTD_HOSTNAME:-${UUID}}"
INTERVAL="${COLLECTD_INTERVAL:-20}"

while sleep "$INTERVAL" ; do
  puppetd=$(ps aux | grep -c [p]uppet )
  echo "PUTVAL $HOST/puppet/gauge-command-total interval=$INTERVAL N:$puppetd"
done
